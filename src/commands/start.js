import { SlashCommandBuilder } from 'discord.js';

const START_ENDPOINT = 'https://aternos.org/ajax/server/start?access-credits=false&TOKEN=a9EiMj0D6VK9zcTN73BW&SEC=tibXSbcT7gZUH8tm%3AtcJe135O7wzgn2xg&SERVER=2wu3E6u5SiPKTjLr';
const AUTH_COOKIE = 'ATERNOS_SEC_ZxrQGdK4cvM21Abk=t0LFBUZ9Ym6YB82U; ATERNOS_SEC_UBHE9gos0MZLmCTa=tQj4RfaNEbengld4; ATERNOS_SEC_1KvwzXENCUrhtlcH=BQ2jL7PUTj8w4bK6; ATERNOS_SEC_XlRpLFM8IrgfBS42=2bL8UbZzBjM3XRVI; ATERNOS_SEC_UMmA0ZyZSCk8fFhy=IaRyq5gCgZNYQbxi; ATERNOS_LANGUAGE=en; ATERNOS_SESSION=mdg295OpMIdlH4inJUkkNcohlkdTuC1sN1laCpTLhdbpahccScCiBvXfs08PlOx3dmbAdwAOta9o5taMRCQnDbaGQtGtKzKmbqZR; _ga=GA1.1.1595320345.1762525725; _sharedid=8a85a837-1011-447a-8d6f-ffefee9bfd0d; _lr_env_src_ats=false; FCCDCF=%5Bnull%2Cnull%2Cnull%2C%5B%22CQahCEAQahCEAEsACBENCEFoAP_gAEPgAAwILcMR9C_sTSFDebZ3KfskaYxP0LhgbsQxBgaBEwIFyJKQJJwEgGEpNAjABCACCBAAMFQBIQMAEAAAAVCAIIABJwAMYEwUIBJIJAAAAAEQAUBYCAAEgIEgUAAIgiC1EkQhkAiEQIpISIgCgABGEACACCQgAJCAAAABAUIAQAAAEAAEQDwQkAlAmAAAAgEAABBIAEAAaCBAIAAAAAABAAAAAAAAAAAAAACAABAAAAAAAAAAAAAAAAAAAAQW4Yj6F_YmkKG8WCvQ_ZIUxi_oXAA3YhiCA0CBgQLkSUgSRgJIMJGSJEAAEAAECAAQKgCQAIQIBAAAKECAQACTiAYAJggQCSQQAAAAEIgAICgAAAJAQJAoAATAEBsIIhDAhEIgRSEkBAEACAEIAEAEEgAASEAAAACIoQAgAAAAEAJgGgBIBKBMAAABAAAACCQAIAA0kAAQAAAAAACAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAgAA.f_wAAAAAAAA%22%2C%222~43.46.55.57.61.70.83.89.93.117.124.135.143.147.149.159.161.184.192.196.228.230.236.239.272.286.291.310.313.314.322.323.327.358.367.370.371.385.394.407.430.442.445.469.486.491.494.495.522.523.550.574.576.584.621.723.737.798.820.827.864.922.931.938.955.979.981.986.1003.1027.1029.1031.1033.1040.1046.1047.1092.1095.1097.1099.1107.1126.1135.1186.1188.1192.1205.1215.1220.1226.1252.1270.1276.1284.1301.1307.1312.1329.1365.1416.1419.1440.1449.1455.1512.1514.1525.1548.1558.1570.1579.1583.1584.1598.1626.1638.1651.1653.1660.1667.1678.1697.1699.1703.1712.1716.1720.1732.1735.1750.1753.1765.1786.1808.1810.1825.1827.1840.1843.1845.1859.1880.1882.1917.1942.1944.1963.1967.1969.1978.1985.2003.2038.2047.2052.2064.2068.2074.2103.2107.2109.2124.2133.2135.2137.2141.2147.2166.2186.2213.2216.2219.2220.2222.2223.2224.2225.2227.2234.2253.2271.2282.2299.2309.2312.2316.2325.2328.2331.2343.2354.2358.2370.2373.2376.2377.2400.2405.2411.2416.2418.2427.2440.2447.2453.2461.2465.2468.2472.2484.2498.2510.2517.2526.2527.2534.2535.2542.2563.2567.2568.2569.2571.2572.2577.2583.2584.2605.2608.2609.2614.2624.2628.2629.2642.2643.2645.2646.2651.2656.2657.2658.2661.2669.2677.2686.2687.2689.2690.2698.2713.2714.2767.2778.2784.2791.2798.2801.2805.2812.2813.2814.2816.2817.2822.2824.2827.2830.2831.2832.2834.2846.2850.2854.2862.2867.2869.2872.2875.2876.2878.2880.2886.2887.2889.2893.2894.2895.2897.2898.2900.2901.2909.2918.2920.2923.2929.2930.2940.2941.2949.2963.2964.2965.2966.2974.2981.2987.2994.2997.3000.3001.3002.3005.3009.3010.3012.3018.3019.3023.3034.3051.3052.3053.3055.3058.3059.3066.3068.3070.3076.3077.3090.3093.3095.3100.3117.3119.3126.3128.3130.3133.3135.3153.3155.3163.3169.3172.3177.3201.3213.3218.3222.3223.3225.3228.3234.3254.3281.3292.3299.3324.3330.4131.4731.4831.7131.13731.39031~dv.%22%2C%220B0CF086-6EF3-4E88-8061-57F7B832FF97%22%5D%2Cnull%2Cnull%2C%5B%5B32%2C%22%5B%5C%2209591322-d61c-4a63-9e4f-2eb6d9e04ad3%5C%22%2C%5B1762525726%2C163000000%5D%5D%22%5D%5D%5D; hb_insticator_uid=a38e102b-3222-4da0-9a3f-2028d15888bc; connectId={\"ttl\":86400000,\"lastUsed\":1762525728397,\"lastSynced\":1762525728397}; _cc_id=65d58dbc1ea95a7d1c03109e41a1278; panoramaId_expiry=1763130527522; panoramaId=5accd04e9896ff51c1ffe1a2d889185ca02c8a3f750f5a26c35abfb966714497; panoramaIdType=panoDevice; _pubcid=49b3c4ba-a957-4352-9d4b-ba0da6648435; _pubcid_cst=%2BPF51Q%3D%3D; _sharedid_cst=QiyxLC8srQ%3D%3D; ATERNOS_SERVER=2wu3E6u5SiPKTjLr; __binsUID=0776729a-a32b-490f-ac3c-afc9def9d2e1; _lr_retry_request=true; __insagBGPercentage=100; __binsSID=e8333c05-54dd-478f-a45f-200b8d819ad5; __gads=ID=a4b6827ec3e2e1b8:T=1762525726:RT=1762530313:S=ALNI_MYXjfJqQrQQR_qUhOsJQJcJ8sI3jQ; __gpi=UID=00001287e4a8a5a0:T=1762525726:RT=1762530313:S=ALNI_MY_VUcn9Z2nDTdvOVaQ7B2STdo3kg; __eoi=ID=1a28d518df4081ca:T=1762525726:RT=1762530313:S=AA-AfjZ0Avp546qvCs213Y_0p1vH; cto_bidid=PAp10l8wJTJCbjJHQ3ZlVWJPc0l4MCUyRnE5OUU2dW1EV2d4bFhWZEtwS1d6dERXZjNLNmJHYzIzRElNUW5iVlBvODM0TW91WmFCRHJDZE12eWZsZFI1WXlsRVRIelpXRVFVQnBZSjU1a3hWTjRJVldKVVUlM0Q; cto_dna_bundle=DIHk219Ka1B0cU1FV2xtUTJSRTF0NlpLSUo4QTlORGVUY0huTSUyRkclMkJIZ3I3T2o1SU1hckdyVWcxdGJRVTdZZVd4QlUlMkJ6bEJwM1Z0a1dreXI5QkpobVg3U1dBQSUzRCUzRA; FCNEC=%5B%5B%22AKsRol_Vj3sq5luE8lTnJdxiMixCCB0wQ63H-RfoMI2LI4UMiU1r27suw1HKsTAsXDsZV1sNcctlHcS8V33WU86zPf6VzJlUHhpjcB8-dyHJvW9XzAJpnlaa1WXGkU2xcPCpyZZymSVhxFqr3zqv5wnqyWXxcdNZsw%3D%3D%22%5D%5D; cto_bundle=1WWAzl9Ka1B0cU1FV2xtUTJSRTF0NlpLSUp4JTJGQVBvZXZISTc1R2NWRXdZUG9KcVJnc2ZEeEtVZmN3OE1BTCUyQkxVUTlhMXBHQkFXdzB2ejdBU3U4JTJGbG1Yd1glMkI1RHViMWdpNmhRT3BhdURmVTAzSTFNM29zcUl4NWRFNG84WEhTU25lSlpMeTVTcUttWGJZR1NxdiUyQjNHdmNxT0xnJTNEJTNE; _ga_70M94GH0FD=GS2.1.s1762529939$o2$g1$t1762530595$j60$l0$h0';
const USER_AGENT = null;

export const data = new SlashCommandBuilder()
  .setName('start')
  .setDescription('Start the modded Minecraft server.');

export async function execute(interaction) {
  await interaction.deferReply({ ephemeral: false });

  await interaction.editReply(
      'Server starting is broken here, instead go to https://aternos.org/servers/ with the username GamingCornerMC and password GamingCornerMC.'
    );
    return;

  if (!START_ENDPOINT) {
    await interaction.editReply(
      'Aternos start endpoint is not configured. Set `ATERNOS_START_ENDPOINT` in your environment.'
    );
    return;
  }

  const headers = {
    accept: '*/*',
  };

  if (USER_AGENT) {
    headers['user-agent'] = USER_AGENT;
  }

  if (AUTH_COOKIE) {
    headers.cookie = AUTH_COOKIE;
  }

  try {
    const response = await fetch(START_ENDPOINT, {
      method: 'GET',
      headers,
    });

    if (!response.ok) {
      const body = await response.text();
      throw new Error(`Aternos start failed with status ${response.status}: ${body}`);
    }

    let payload;
    try {
      payload = await response.json();
    } catch (error) {
      payload = null;
    }

    if (payload?.success === false) {
      await interaction.editReply(
        payload?.error || 'Aternos responded but did not accept the start request. Check the credentials on the server.'
      );
      return;
    }

    await interaction.editReply('Server starting.. It will take a couple minutes to come online but you can check the status with `/status`.');
  } catch (error) {
    console.error('Failed to trigger Aternos server start', error);
    await interaction.editReply('Unable to reach the server. Verify the credentials on the server and try again.');
  }
}
